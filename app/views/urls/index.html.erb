<%- model_class = Url -%>
<!-- <div class="page-header">
  <h4><%=t '.title', :default => model_class.model_name.human.pluralize.titleize %></h3>
</div> -->

<div id="pending-transfer-requests-to">
  <%= render 'transfer_requests_to' %>
</div>

<div id="pending-transfer-requests-from">
  <%= render 'transfer_requests_from' %>
</div>

<h2>
  Viewing URLs for the <%= link_to @group.name, group_members_path(@group) %> Collection
  <br/>
  <i>
    <%= @group.description unless @group.id.eql? current_user.default_group_id%>
  </i>
</h2>

<div id="new-url-form">
  <!-- <div class="new-url-form-hint">Shorten a URL</div> -->
  <!-- <h1>Should you plan a meetin to talk over UI changes and GROUPS?</h1> -->
  <%= render 'form', url: @url %>
</div>

<table id="urls-table" class="table user-table table-striped table-bordered data-table" data-source="<%= datatable_urls_path(format: :json) %>">
  <thead>
    <tr>
      <th></th>
      <th><%= t('helpers.table_headers.url')  %></th>
      <th><%= t('helpers.table_headers.keyword') %></th>
      <th><%= t('helpers.table_headers.total_clicks') %></th>
      <th><%= t('helpers.table_headers.created_on') %></th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>


<script type="text/javascript">
  <%= render partial: 'urls/show_js/move.js' %>
  <%= render partial: 'urls/show_js/transfer.js' %>
  $(document).ready(function() {
    var transferText = '<i class="fa fa-exchange"></i> Transfer to a different user';
    var moveText = '<i class="fa fa-share-square-o "></i> Move to a different collection';
    var selectAllText = 'Select all';
    var selectNoneText = 'Select none'
    var keywordColumn = 2;

    var userTable = $('#urls-table').DataTable({
      "pageLength": 25,
      buttons: [

      ],
      language: {
        buttons: {
          selectAll: selectAllText,
          selectNone: selectNoneText
        }
      },
      columns: [
            {data: '0' },
            {data: '1' },
            {data: '2' },
            {data: '3' },
            {data: '4' }
          ],
      "processing": true,
      "serverSide": true,
      "ajax": $('#urls-table').data('source'),
      "pagingType": "full_numbers",
      "order": [
        4,
        "desc"
      ],
      columnDefs: [
        {
          className: 'select-checkbox',
          targets:   0,
          title:"<input type='checkbox' id='select-all' class='select-checkbox'/>"
        },
        {
          orderable: false,
          searchable: false,
          targets: [0]
        }
      ],
      select: {
        style:    'multi',
        selector: 'td:first-child'
      },

    });
    $('table.data-table').on("page.dt", function(e){
        userTable.rows().deselect();
        $("#select-all").prop("checked", false);
    });
    $("#select-all").click(function(e){
        $(e.target).prop("checked") === true ? userTable.rows({page:"current"}).select() : userTable.rows().deselect();
    });

      var transfer_button = {
        extend: 'selected',
        text: transferText,
          className:'btn-primary js-transfer-urls',
        action: function ( e, dt, node, config ) {
          var keywords = [];
          userTable.rows('.selected').data().map(function (row) {
            keywords.push(row['DT_RowData']['keyword'])
          });

          transferUrl('<%= new_transfer_request_path %>', keywords);

        }
      }

      var move_button = {
        extend: 'selected',
        className:'btn-primary js-move-urls',
        text: moveText,
        action: function ( e, dt, node, config ) {
          var keywords = [];
          userTable.rows('.selected').data().map(function (row) {
            keywords.push(row['DT_RowData']['keyword'])
          });

          moveUrl('<%= new_move_to_group_path %>', keywords);

        }
      }

      buttons = []
      buttons = [transfer_button, move_button]

      new $.fn.dataTable.Buttons( userTable, {
        buttons: buttons
      });

      window.userTable = userTable;
      userTable
        .buttons(0, null)
        .container()
        .prependTo('.dataTables_wrapper >.row:eq(0) > .col-sm-6:eq(0)');

      $(".col-sm-6 .dt-buttons").removeClass("btn-group");
  });
</script>


<%= render 'modal' %>
